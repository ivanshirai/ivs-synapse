{
	"name": "ZeroRow",
	"properties": {
		"content": {
			"query": "CREATE PROC [dbo].[ZeroRow]\n\t@p_tabname [varchar](255),\n\t@p_keycolname [varchar](255),\n\t@p_varchar [varchar](255),\n\t@p_numeric [tinyint],\n\t@p_date [date],\n\t@p_time [time],\n\t@p_bit [bit] \n\t\nAS\n\nDECLARE\n\t@v_return_status integer,\n\t@v_count bit = 0,\n\t@v_column_name varchar(255),\n\t@v_data_type varchar(255),\n\t@v_character_maximum_length integer,\n\t@v_is_nullable varchar(3),\n\t@v_notnull_conv varchar(255),\n\t@v_ins_sql_top varchar(max),\n\t@v_ins_sql_bottom varchar(max),\n\t@v_upd_sql varchar(max),\n\t@v_ctrl_sql nvarchar(max) = '',\n\t@v_sql nvarchar(max) = '',\n\t@v_sql_param nvarchar(max) = ''\n\nBEGIN\n    CREATE TABLE #tbl\n\tWITH\n\t( DISTRIBUTION = ROUND_ROBIN\n\t)\n\tAS\n\tselect \n\tROW_NUMBER() OVER(ORDER BY ordinal_position) AS sequence,\n\tcolumn_name,\n\tis_nullable,\n\tdata_type,\n\tcharacter_maximum_length\n\tfrom information_schema.columns\n\twhere table_name = @p_tabname\n\n\tDECLARE @v_loop_limit int = (SELECT COUNT(*) FROM #tbl)\n\t,       @v_i int = 1\n\n\tSET @v_ins_sql_top = '('\n\tSET @v_ins_sql_bottom = '('\n\tSET @v_upd_sql = ''\n\tSET @v_sql_param = N'@v_column_name varchar(255) OUTPUT, ' +\n\t\t\t\t\tN'@v_is_nullable varchar(3) OUTPUT, ' +\n\t\t\t\t\tN'@v_data_type varchar(255) OUTPUT, ' +\n\t\t\t\t\tN'@v_character_maximum_length integer OUTPUT'\n\n\tWHILE @v_i <= @v_loop_limit\n\t  BEGIN\n\n\t\tSET @v_sql = N'SELECT @v_column_name = column_name, ' +\n\t\t\tN'@v_is_nullable = is_nullable, ' +\n\t\t\tN'@v_data_type = data_type, ' +\n\t\t\tN'@v_character_maximum_length = character_maximum_length FROM #tbl WHERE sequence = ' + CAST(@v_i as nvarchar(20))\n\n\t\tEXECUTE sp_executesql @v_sql, @v_sql_param, \n\t\t\t\t\t\t\t\t@v_column_name OUTPUT, \n\t\t\t\t\t\t\t\t@v_is_nullable OUTPUT,\n\t\t\t\t\t\t\t\t@v_data_type OUTPUT, \n\t\t\t\t\t\t\t\t@v_character_maximum_length OUTPUT\n\n\t\tSET @v_ins_sql_top = @v_ins_sql_top + @v_column_name + char(13) + ', '\n\n\t\tIF (@v_data_type = 'char' or @v_data_type = 'varchar' \n\t\tor @v_data_type = 'text' or @v_data_type = 'nchar' \n\t\tor @v_data_type = 'nvarchar' or @v_data_type = 'ntext')\n\t\t\tBEGIN\n\t\t\t\tSET @v_ins_sql_bottom = @v_ins_sql_bottom + char(39) + LEFT(@p_varchar, @v_character_maximum_length) + char(39) + char(13) + ', '\n\t\t\t\tSET @v_upd_sql = @v_upd_sql + @v_column_name + ' = ' + char(39) + LEFT(@p_varchar, @v_character_maximum_length) + char(39) + char(13) + ', '\n\t\t\tEND\n\t\tELSE\n\t\t\tIF (@v_data_type = 'date' or @v_data_type = 'datetime' \n\t\t\tor @v_data_type = 'datetime2' or @v_data_type = 'datetimeoffset' \n\t\t\tor @v_data_type = 'smalldatetime') \n\t\t\tand (try_cast(@p_date as date) is not null \n\t\t\tor @v_column_name = 'DSS_UPDATE_TIME' or @v_column_name = 'DSS_CREATE_TIME')\n\t\t\t\tBEGIN\n\t\t\t\t\tIF @v_column_name = 'DSS_UPDATE_TIME'\n\t\t\t\t\t\tBEGIN\n\t\t\t\t\t\t\tSET @v_ins_sql_bottom = @v_ins_sql_bottom + char(39) + CONVERT(varchar, getdate(), 121) + char(39) + char(13) + ', '\n\t\t\t\t\t\t\tSET @v_upd_sql = @v_upd_sql + @v_column_name + ' = ' + char(39) + CONVERT(varchar, getdate(), 121) + char(39) + char(13) + ', '\n\t\t\t\t\t\tEND\n\t\t\t\t\tELSE\n\t\t\t\t\t\tBEGIN\n\t\t\t\t\t\t\tIF @v_column_name = 'DSS_CREATE_TIME'\n\t\t\t\t\t\t\t\tBEGIN\n\t\t\t\t\t\t\t\t\tSET @v_ins_sql_bottom = @v_ins_sql_bottom + char(39) + CONVERT(varchar, getdate(), 121) + char(39) + char(13) + ', '\n\t\t\t\t\t\t\t\t\tSET @v_upd_sql = @v_upd_sql + @v_column_name + ' = COALESCE(DSS_CREATE_TIME, getdate())' + char(13) + ', '\n\t\t\t\t\t\t\t\tEND\n\t\t\t\t\t\t\tELSE\n\t\t\t\t\t\t\t\tBEGIN\n\t\t\t\t\t\t\t\t\tSET @v_ins_sql_bottom = @v_ins_sql_bottom + char(39) + cast(@p_date as varchar) + char(39) + char(13) + ', '\n\t\t\t\t\t\t\t\t\tSET @v_upd_sql = @v_upd_sql + @v_column_name + ' = ' + char(39) + cast(@p_date as varchar) + char(39) + char(13) + ', '\n\t\t\t\t\t\t\t\tEND\n\t\t\t\t\t\tEND\n\t\t\t\tEND\n\t\t\tELSE\n\t\t\t\tIF @v_data_type = 'time' and try_cast(@p_time as time) is not null\n\t\t\t\t\tBEGIN\n\t\t\t\t\t\tSET @v_ins_sql_bottom = @v_ins_sql_bottom + char(39) + cast(@p_time as varchar) + char(39) + char(13) + ', '\n\t\t\t\t\t\tSET @v_upd_sql = @v_upd_sql + @v_column_name + ' = ' + char(39) + cast(@p_time as varchar) + char(39) + char(13) + ', '\n\t\t\t\t\tEND\n\t\t\t\tELSE\n\t\t\t\t\tIF (@v_data_type = 'bigint' or @v_data_type = 'numeric' \n\t\t\t\t\tor @v_data_type = 'smallint' or @v_data_type = 'decimal' \n\t\t\t\t\tor @v_data_type = 'smallmoney' or @v_data_type = 'int'\n\t\t\t\t\tor @v_data_type = 'tinyint' or @v_data_type = 'money'\n\t\t\t\t\tor @v_data_type = 'float' or @v_data_type = 'real') \n\t\t\t\t\tand try_cast(@p_numeric as tinyint) is not null\n\t\t\t\t\tand UPPER(@v_column_name) <> UPPER(@p_keycolname)\n\t\t\t\t\t\tBEGIN\n\t\t\t\t\t\t\tSET @v_ins_sql_bottom = @v_ins_sql_bottom + cast(@p_numeric as varchar) + char(13) + ', '\n\t\t\t\t\t\t\tSET @v_upd_sql = @v_upd_sql + @v_column_name + ' = ' + cast(@p_numeric as varchar) + char(13) + ', '\n\t\t\t\t\t\tEND\n\t\t\t\t\tELSE\n\t\t\t\t\t\tIF @v_data_type = 'bit' and try_cast(@p_bit as bit) is not null\n\t\t\t\t\t\t\tBEGIN\n\t\t\t\t\t\t\t\tSET @v_ins_sql_bottom = @v_ins_sql_bottom + cast(@p_bit as varchar) + char(13) + ', '\n\t\t\t\t\t\t\t\tSET @v_upd_sql = @v_upd_sql + @v_column_name + ' = ' + cast(@p_bit as varchar) + char(13) + ', '\n\t\t\t\t\t\t\tEND\n\t\t\t\t\t\tELSE\n\t\t\t\t\t\t\tBEGIN\n\t\t\t\t\t\t\t\tIF UPPER(@v_column_name) = @p_keycolname\n\t\t\t\t\t\t\t\t\tBEGIN\n\t\t\t\t\t\t\t\t\t\tSET @v_ins_sql_bottom = @v_ins_sql_bottom + '0' + char(13) + ', '\n\t\t\t\t\t\t\t\t\tEND\n\t\t\t\t\t\t\t\tELSE\n\t\t\t\t\t\t\t\t\tBEGIN\n\t\t\t\t\t\t\t\t\t\tIF @v_is_nullable = 'YES'\n\t\t\t\t\t\t\t\t\t\t\tBEGIN\n\t\t\t\t\t\t\t\t\t\t\t\tSET @v_ins_sql_bottom  = @v_ins_sql_bottom + 'NULL' + char(13) + ', '\n\t\t\t\t\t\t\t\t\t\t\t\tSET @v_upd_sql = @v_upd_sql + @v_column_name + ' = ' + 'NULL' + char(13) + ', '\n\t\t\t\t\t\t\t\t\t\t\tEND\n\t\t\t\t\t\t\t\t\t\tELSE\n\t\t\t\t\t\t\t\t\t\t\tBEGIN\n\t\t\t\t\t\t\t\t\t\t\t\tSET @v_ctrl_sql = N'select @v_val_conv = cast('+ char(39) + char(39) + ' as ' + @v_data_type + N')'\n\t\t\t\t\t\t\t\t\t\t\t\tEXECUTE sp_executesql @v_ctrl_sql, N'@v_val_conv varchar(255) OUTPUT', @v_notnull_conv OUTPUT\n\t\t\t\t\t\t\t\t\t\t\t\tSET @v_ins_sql_bottom  = @v_ins_sql_bottom + @v_notnull_conv + char(13) + ', '\n\t\t\t\t\t\t\t\t\t\t\t\tSET @v_upd_sql = @v_upd_sql + @v_column_name + ' = ' + char(39) + @v_notnull_conv + char(39) + char(13) + ', '\n\t\t\t\t\t\t\t\t\t\t\tEND\n\t\t\t\t\t\t\t\t\tEND\n\t\t\t\t\t\t\tEND\n\n\t\tSET @v_i += 1\n\n\t  END\n\n\tSET @v_ins_sql_top = LEFT(@v_ins_sql_top, LEN(@v_ins_sql_top) - 2) + ')'\n\tSET @v_ins_sql_bottom = LEFT(@v_ins_sql_bottom, LEN(@v_ins_sql_bottom) - 2) + ')'\n\tSET @v_upd_sql = LEFT(@v_upd_sql, LEN(@v_upd_sql) - 2)\n\n\tSET @v_ctrl_sql = N'SELECT @v_count_out = 1 FROM ' + @p_tabname + N' WHERE ' + @p_keycolname + N' = 0'\n\n\tEXECUTE sp_executesql @v_ctrl_sql, N'@v_count_out bit OUTPUT', @v_count OUTPUT\n\n\tSET @v_sql = N'BEGIN' + char(13) + char(13)\n\n\tIF @v_count = 0\n\t\tBEGIN\n\t\t\tSET @v_sql = @v_sql + N'SET IDENTITY_INSERT ' + @p_tabname + N' ON' + char(13) + char(13)\n\t\t\tSET @v_sql = @v_sql + N'INSERT INTO ' + @p_tabname + char(13) + @v_ins_sql_top + char(13)\n\t\t\tSET @v_sql = @v_sql + N'VALUES ' + @v_ins_sql_bottom + char(13) + char(13)\n\t\t\tSET @v_sql = @v_sql + N'SET IDENTITY_INSERT ' + @p_tabname + N' OFF' + char(13) + char(13)\n\t\tEND\n\n\tIF @v_count = 1\n\t\tBEGIN\n\t\t\tSET @v_sql = @v_sql + N'UPDATE ' + @p_tabname + char(13) + N'SET' + char(13) + @v_upd_sql + char(13)\n\t\t\tSET @v_sql = @v_sql + N'WHERE ' + @p_keycolname + N' = 0' + char(13) + char(13)\n\t\tEND\n\n\tSET @v_sql = @v_sql + N'END'\n\n\tEXECUTE sp_executesql @v_sql\n\n\tDROP TABLE #tbl\nEND\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"poolName": "ivs_sqlpool",
				"databaseName": "ivs_sqlpool"
			}
		},
		"type": "SqlQuery"
	}
}